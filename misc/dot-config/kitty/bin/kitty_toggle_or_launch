#!/bin/bash
#

ARGS=()
while [[ "$#" -gt 0 ]]; do case $1 in
    --tab)    tab_index=$2 ; shift 2 ;;
    --to)     to="--to $2" ; shift 2 ;;
    --title)  title="$2"   ; shift 2 ;;
    *)        ARGS+=("$1") ; shift ;;
esac; done

set -- "${ARGS[@]}"

if (kitten @ ls ${to} -m title:${title} &>/dev/null); then
  kitten @ focus-window ${to} -m title:${title}
elif [[ -n $tab_index ]]; then
  kitten @ launch ${to} -m index:$tab_index --title=${title} "${ARGS[@]}"
  kitten @ focus-window ${to} -m title:${title}
else
  kitten @ launch ${to} --type=tab --title=${title} "${ARGS[@]}"
fi
